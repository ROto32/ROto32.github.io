<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Key Management Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
  <div id="login-container" class="panel">
    <h1>Login</h1>
    <label>Username:</label>
    <input type="text" id="username" placeholder="Enter username" />
    <label>Password:</label>
    <input type="password" id="password" placeholder="Enter password" />
    <label>
      <input type="checkbox" id="rememberMe"> Remember Me
    </label>
    <button onclick="login()">Login</button>
    <div id="loginStatus" class="output"></div>
  </div>

  <div id="dashboard" style="display: none;">
    <div class="tabs">
      <div class="tab" onclick="openTab('keys')">
        <img src="icons/key.png" alt="Keys Icon"> Keys
      </div>
      <div class="tab" onclick="openTab('users')">
        <img src="icons/user.png" alt="Users Icon"> Users
      </div>
      <div class="tab" onclick="openTab('example')">
        <img src="icons/paper.png" alt="Example Icon"> Example
      </div>
      <div class="tab" onclick="openTab('settings')">
        <img src="icons/cog.png" alt="Settings Icon"> Settings
      </div>
    </div>

    <div class="tab-content" id="keys" style="display: none;">
      <h2>Generate Keys</h2>
      <label>Number of Keys:
        <input type="number" id="keyCount" placeholder="Enter number of keys" min="1" />
      </label>
      <label>Duration Type:
        <select id="durationType">
          <option value="hours">Hours</option>
          <option value="days">Days</option>
          <option value="months">Months</option>
          <option value="years">Years</option>
        </select>
      </label>
      <label>Duration Value:
        <input type="number" id="durationValue" placeholder="Enter duration value" />
      </label>
      <button onclick="generateKeys()">Generate Keys</button>
      <button onclick="copyGeneratedKeys()">Copy All Keys</button>
      <div id="generatedKey" class="output"></div>
      <h3>Generated Keys</h3>
      <ul id="recentlyGeneratedKeys"></ul>
    </div>

    <div class="tab-content" id="users" style="display: none;">
      <h2>All Keys</h2>
      <label>Keys Per Page:
        <input type="number" id="keysPerPage" placeholder="Enter number of keys" min="1" max="20" value="5" />
      </label>
      <button onclick="loadKeys()">Load Keys</button>
      <div id="keyPaginationControls">
        <button onclick="previousPage()">Previous</button>
        <button onclick="nextPage()">Next</button>
      </div>
      <div id="userGeneratedKeys"></div>
    </div>

    <div class="tab-content" id="example" style="display: none;">
      <h2>Lua Example Code for Key Validation</h2>
      <div class="code-block">
        <pre><code class="language-lua">
-- Lua Example Code
local JSONBIN_API_KEY = "$2a$10$nINI7pBO7a.W7H0knci4VehSa2YblgI/5pz/FMsoroByYUqKO./Ju"
local BIN_ID = "672e5527e41b4d34e450f833"

local function fetchKeys()
    local url = "https://api.jsonbin.io/v3/b/" .. BIN_ID .. "/latest"
    local headers = {
        ["X-Master-Key"] = JSONBIN_API_KEY,
        ["Content-Type"] = "application/json"
    }

    local success, response = pcall(function()
        return request({
            Url = url,
            Method = "GET",
            Headers = headers
        })
    end)

    if not success or not response then return nil end
    return game:GetService("HttpService"):JSONDecode(response.Body).record.keys
end

local function validateKey(userKey)
    local keys = fetchKeys()
    for _, keyData in ipairs(keys) do
        if keyData.key == userKey and keyData.expiresAt > os.date("!%Y-%m-%dT%H:%M:%S") then
            return true
        end
    end
    return false
end
        </code></pre>
      </div>
    </div>

    <div class="tab-content" id="settings" style="display: none;">
      <h2>Settings</h2>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <script>
    const JSONBIN_API_KEY = "$2a$10$nINI7pBO7a.W7H0knci4VehSa2YblgI/5pz/FMsoroByYUqKO./Ju"; 
    const USERS_BIN_ID = "6730f8caacd3cb34a8a61117"; 
    const BIN_ID = "672e5527e41b4d34e450f833";
    let currentPage = 1;

    async function fetchUsers() {
      const response = await fetch(`https://api.jsonbin.io/v3/b/${USERS_BIN_ID}/latest`, {
        headers: { "X-Master-Key": JSONBIN_API_KEY }
      });
      return (await response.json()).record.users || [];
    }

    async function login() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      const rememberMe = document.getElementById("rememberMe").checked;

      const users = await fetchUsers();
      const user = users.find(user => user.username === username && user.passwordHash === password);

      if (user) {
        if (rememberMe) localStorage.setItem("loggedIn", "true");
        document.getElementById("login-container").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        openTab('keys');
      } else {
        document.getElementById("loginStatus").innerText = "Invalid username or password.";
      }
    }

    function logout() {
      localStorage.removeItem("loggedIn");
      document.getElementById("login-container").style.display = "block";
      document.getElementById("dashboard").style.display = "none";
    }

    function openTab(tabName) {
      const contents = document.getElementsByClassName("tab-content");
      for (let content of contents) content.style.display = "none";
      document.getElementById(tabName).style.display = "block";
    }

    function generateRandomKey() {
      const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      return "KEY-" + Array.from({ length: 7 }, () => characters.charAt(Math.floor(Math.random() * characters.length))).join('');
    }

    async function generateKeys() {
      const keyCount = parseInt(document.getElementById("keyCount").value) || 1;
      const durationType = document.getElementById("durationType").value;
      const durationValue = parseInt(document.getElementById("durationValue").value);
      const expirationDate = new Date();

      switch (durationType) {
        case "hours": expirationDate.setHours(expirationDate.getHours() + durationValue); break;
        case "days": expirationDate.setDate(expirationDate.getDate() + durationValue); break;
        case "months": expirationDate.setMonth(expirationDate.getMonth() + durationValue); break;
        case "years": expirationDate.setFullYear(expirationDate.getFullYear() + durationValue); break;
      }

      const generatedKeys = Array.from({ length: keyCount }, () => ({
        key: generateRandomKey(),
        expiresAt: expirationDate.toISOString(),
        userId: null
      }));

      document.getElementById("recentlyGeneratedKeys").innerHTML = generatedKeys.map(k => `<li>${k.key}</li>`).join('');

      const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": JSONBIN_API_KEY } });
      const existingKeys = (await response.json()).record.keys || [];
      await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json", "X-Master-Key": JSONBIN_API_KEY, "X-Bin-Versioning": "false" },
        body: JSON.stringify({ keys: existingKeys.concat(generatedKeys) })
      });
      loadKeys();
    }

    function copyGeneratedKeys() {
      const keys = Array.from(document.getElementById("recentlyGeneratedKeys").children).map(li => li.textContent).join('\n');
      navigator.clipboard.writeText(keys).then(() => alert("All generated keys copied to clipboard!"));
    }

    async function loadKeys() {
      const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": JSONBIN_API_KEY } });
      const keys = (await response.json()).record.keys || [];
      const keysPerPage = parseInt(document.getElementById("keysPerPage").value) || 5;
      const startIndex = (currentPage - 1) * keysPerPage;
      const endIndex = Math.min(startIndex + keysPerPage, keys.length);

      document.getElementById("userGeneratedKeys").innerHTML = `
        ${keys.slice(startIndex, endIndex).map(keyData => `
          <div class="key-card">
            <h3>${keyData.key}</h3>
            <p>Expires: ${new Date(keyData.expiresAt).toLocaleString()}</p>
            <p>Locked to User ID: ${keyData.userId || "Not Locked"}</p>
          </div>
        `).join('')}
      `;
    }

    function nextPage() { currentPage++; loadKeys(); }
    function previousPage() { if (currentPage > 1) currentPage--; loadKeys(); }

    if (localStorage.getItem("loggedIn") === "true") {
      document.getElementById("login-container").style.display = "none";
      document.getElementById("dashboard").style.display = "block";
      openTab('keys');
    }

    loadKeys();
  </script>
</body>
</html>
